{% include organisation_header.html %}

<main>
    <!-- Read in report_sections from corresponding _data JSON -->
    {% assign report = site.data.organisations | where:"organisation", page.organisation | first %}
    {% assign report_sections = report.charts %}
    {% assign axe_core_percentile = report.axe_core_percentile %}
    <h2>Table of contents</h2>
    <nav aria-label="Table of contents">
        <ul id="toc">
            {% for section in report_sections %}
                <li>
                    <a href="#{{forloop.index0}}-heading">{{section.chartTitle}}</a>
                </li>
            {% endfor %}
        </ul>
    </nav>

    <h2>Notes</h2>

    <div class="note" role="note">
        <p>
            <strong>Note:</strong>
            If you notice any errors or have any feedback, contact us at
            <a href="mailto:web.standards@dia.govt.nz">web.standards@dia.govt.nz</a>.
        </p>
    </div>
    <details class="disclaimers">
        <summary>Disclaimers</summary>
        <div class="note" role="note">
            <p>
                <strong>Note:</strong>
                CWAC provides indicative results only.
                Automated testing cannot detect all accessibility issues.
                Manual testing is still required to assess conformance to the
                <a href="https://www.w3.org/TR/WCAG21/">Web Content Accessibility Guidelines (WCAG) 2.1</a>.
            </p>
        </div>
        <div class="note" role="note">
            <p>
                <strong>Note:</strong>
                Colours used in the visual charts do not have any intended meaning,
                other than to communicate that high values are generally worse than
                low values.
            </p>
        </div>
    </details>

    <!-- if report.anti_bot_data has len of 0 -->
    {% if report.anti_bot_data != empty %}
        <details class="disclaimers">
            <summary>Websites that blocked CWAC</summary>
            
            <div class="details-content">
                <p>
                   Sometimes, anti-bot systems
                   such as Cloudflare, or Imperva will block CWAC.
                </p>
                <table class="cwac-table">
                    <caption>Websites that blocked CWAC</caption>
                    <thead>
                        <tr>
                            <th>Domain</th>
                            <th>Blocked by</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- iterate report.anti_bot_data as a table, where column 1 is the key, column 2 is the value-->
                        {% for row in report.anti_bot_data %}
                            <tr>
                                <td>{{row[0]}}</td>
                                <td>{{row[1]}}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </details>
    {% endif %}

    <details>
        <summary>Help for understanding the data</summary>

        <div class="details-content">
            <p>
                This help section will explain how to interpret the raw data
                CSV files that are available for download at the end of each
                section.
            </p>

            <h3>Column headings</h3>
            
            <dl>
                <dt>organisation</dt>
                <dd>
                    The name of the organisation that owns the website that was tested.
                </dd>

                <dt>page_title</dt>
                <dd>
                    The title of the page that was tested.
                </dd>
                
                <dt>base_url</dt>
                <dd>
                    The homepage of the website that was tested.
                </dd>

                <dt>url</dt>
                <dd>
                    The URL of the page that was tested. Will be a page that belongs to base_url.
                </dd>

                <dt>viewport_size</dt>
                <dd>
                    A JSON object containing the width and height of the browser viewport that was used to test the page.
                </dd>
                
                <dt>audit_id, page_id, issue_id</dt>
                <dd>
                    Various unique identifiers for the audit, page and issue respectively.
                </dd>

                <dt>audit_type</dt>
                <dd>
                    The name of the audit type that was run.
                </dd>

                <dt>description</dt>
                <dd>
                    A description of the issue that was found.
                </dd>

                <dt>target</dt>
                <dd>
                    An xpath that points to the element that the issue was found on.
                </dd>

                <dt>count</dt>
                <dd>
                    The number of times the issue was found on the page. It will be 1
                    or greater if an issue was discovered, and 0 if no issues were found.
                    On the "template-aware" audit, this column will count the number of
                    pages an issue was repeated on.
                </dd>

                <dt>help</dt>
                <dd>
                    A description of how to fix the issue.
                </dd>

                <dt>helpUrl</dt>
                <dd>
                    A URL to a page that describes how to fix the issue.
                </dd>

                <dt>id</dt>
                <dd>
                    An identifier from axe-core that identifies the rule that was broken.
                </dd>

                <dt>impact</dt>
                <dd>
                    An estimation of how severe the issue is.
                </dd>

                <dt>html</dt>
                <dd>
                    A short HTML snippet of the element that the issue was found on.
                </dd>

                <dt>tags</dt>
                <dd>
                    A list of tags in a JSON list that are associated with the issue.
                </dd>

                <dt>best-practice</dt>
                <dd>
                    '0' or 'False' if the issue is a WCAG failure, 'True' or '1' if it is just a 'recommendation'. Filter to just 'False'/'0' to see strict WCAG failures.
                </dd>

                <dt>flesch_kincaid_gl</dt>
                <dd>
                    The Flesch-Kincaid Grade Level of the text on the page.
                </dd>

                <dt>smog_gl</dt>
                <dd>
                    The SMOG Grade Level of the text on the page.
                </dd>

                <dt>overflows</dt>
                <dd>
                    'True' if the page scrolls horizontally at 320px wide. 'False' if it does not.
                </dd>

                <dt>overflow_amount_px</dt>
                <dd>
                    The amount of horizontal scrolling that occurs at 320px wide, with a max of 100
                </dd>
            </dl>
        </div>
    </details>

    <h2 id="page-title">Report data</h2>

    </p>

    {% for section in report_sections %}
        {% include chart_section.html
            sectionHeading=section.sectionHeading
            chartTitle=section.chartTitle
            description=section.description
            chartImageLight=section.chartImageLight
            chartImageDark=section.chartImageDark
            organisation=page.organisation
            auditType=section.auditType
            axe_core_percentile=axe_core_percentile
            uniqueID=forloop.index0
        %}
    {% endfor %}
</main>

{% include footer.html %}